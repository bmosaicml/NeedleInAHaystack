integrations:
- integration_type: git_repo
  git_repo: bmosaicml/NeedleInAHaystack
  git_branch: master
  # git_commit:  # OR use your commit hash
  pip_install: -e .
  ssh_clone: false  # Should be true if using a private repo
- integration_type: wandb
  entity: mosaic-ml
  project: dependent_deployment_eval_jeremy

name: niah-gpt-3-5-turbo
gpu_num: 8
# gpu_type:
cluster:  r1z1  # replace with your cluster here!

image: mosaicml/llm-foundry:2.2.1_cu121_flash2-latest


command: |
  export OPENAI_API_KEY=insert_your_key
  export MISTRAL_API_KEY=insert_your_key
  export GEMINI_API_KEY=insert_your_key
  export ANTHROPIC_API_KEY=insert_your_key
  export AWS_PROFILE=data-force-one
  aws s3 cp s3://data-force-one-datasets/jeremy/ results   --recursive
  pip uninstall llmfoundry -y
  pip install git+https://github.com/mosaicml/llm-foundry.git@openai_compatible_gauntlet
  pip uninstall mosaicml -y
  pip install git+https://github.com/mosaicml/composer.git@dev
  cd NeedleInAHaystack/needlehaystack
  python3 full_experiment.py /mnt/config/parameters.yaml
  aws s3 cp results s3://data-force-one-datasets/jeremy  --recursive

parameters:
  context_lengths_min: 1000
  context_lengths_max: 14_000
  context_lengths_num_intervals: 15
  document_depth_percent_min: 0
  document_depth_percent_max: 100
  document_depth_num_intervals: 25
  tasks:
  -
    needle: "The best thing to do in San Francisco is eat a sandwich and sit in Dolores Park on a sunny day."
    retrieval_question: "What is the best thing to do in San Francisco?"
  -
    needle: "The special magic New York number is 7897."
    retrieval_question: "What is the magic number?"
    answer: "7897"
  -
    needle: "Figs are one of the secret ingredients needed to build the perfect pizza."
    retrieval_question: "What is one of the secret ingredients to build the perfect pizza?"
  -
    needle: "Magnus Doofenschmirtz's birthday is 11/14/1997"
    retrieval_question: "What is Magnus Doofenschmirtz's birthday?"
  -
    needle: "This essay is derived from a guest lecture in Sam Altman's startup class."
    retrieval_question: "Whose startup class was the guest lecture in?"
    answer: "Sam Altman's"

  models:
  # -
  #   model_name: "models/gemini-1.0-pro-latest"
  # -
  #   model_name: "claude-3-opus-20240229"
  # -
  #   model_name: "claude-3-sonnet-20240229"
  # -
  #   model_name: "claude-3-haiku-20240307"
  # -
  #   model_name: "gpt-4-turbo-preview"
  # -
  #   model_name: "mosaicml/pi-ift-v1"
  -
    model_name: "gpt-3.5-turbo"
  # -
  #   model_name: "mistralai/Mistral-large"
  # -
  #   model_name: "mistralai/Mixtral-8x7B-Instruct-v0.1"
